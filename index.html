diff --git a/index.html b/index.html
index 3dd95b4ae556a6061736169a7f1cf1da8cbb5fd0..29cd46499dd7104fbb02c200a2301ebdce7319e1 100644
--- a/index.html
+++ b/index.html
@@ -181,150 +181,164 @@ let lightTiles, darkTiles;
 let darkMode = false;
 
 // =========================
 // HAZARD COLOR & MESSAGE
 // =========================
 function hazardColor(level) {
   level = Number(level);
   return level === 1 ? "#00cc44" :
          level === 2 ? "#ffff33" :
          level === 3 ? "#ff9933" :
          level === 4 ? "#ff3300" :
          level === 5 ? "#990000" :
          "#555";
 }
 
 function riskMessage(level) {
   level = Number(level);
   return level === 1 ? "Safe area" :
          level === 2 ? "Low hazard" :
          level === 3 ? "Moderate hazard" :
          level === 4 ? "High hazard" :
          level === 5 ? "Extreme hazard" :
          "Unknown";
 }
 
-// =========================
-// MAP INIT
-// =========================
-var map = L.map("map", {
-  center: [31.9, 35.2],
-  zoom: 12
-});
-
-let apiKey = "eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImU0MGJmYjNiZDY2ODRhNTdiYTg1MTZkZmVlN2Q1Yzg2IiwiaCI6Im11cm11cjY0In0=";
+// =========================
+// API CONFIG
+// =========================
+const OPENROUTESERVICE_KEY = "eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImU0MGJmYjNiZDY2ODRhNTdiYTg1MTZkZmVlN2Q1Yzg2IiwiaCI6Im11cm11cjY0In0=";
+const OPENWEATHER_KEY = "384571a4172844344b2e6e07ca33c936";
+
+// =========================
+// MAP INIT
+// =========================
+var map = L.map("map", {
+  center: [31.9, 35.2],
+  zoom: 12
+});
 
 // base layers
 lightTiles = L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
   maxZoom: 19
 }).addTo(map);
 
 darkTiles = L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png", {
   maxZoom: 19
 });
 
 // disable default double-click zoom (we use it for route)
 map.doubleClickZoom.disable();
 
 // =========================
 // USER LOCATION
 // =========================
 let userReportDiv = document.getElementById("userReport");
 
-map.locate({ setView: true, maxZoom: 14 });
+map.locate({ setView: true, maxZoom: 14 });
 
-map.on("locationfound", e => {
-  userLocation = e.latlng;
-  L.marker(e.latlng).addTo(map).bindPopup("Your location");
-  userReportDiv.textContent = "Location detected.";
-});
-
-map.on("locationerror", () => {
-  userReportDiv.textContent = "Location not available.";
-});
+map.on("locationfound", e => {
+  userLocation = e.latlng;
+  L.marker(e.latlng).addTo(map).bindPopup("Your location");
+  userReportDiv.textContent = `Location detected: ${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
+});
+
+map.on("locationerror", (err) => {
+  console.error("Geolocation error", err);
+  userReportDiv.textContent = "Location not available.";
+});
 
 // =========================
 // STYLE FUNCTIONS
 // =========================
 function styleRain10(feature) {
   const gc = Number(feature.properties.gridcode);
   const colors = {
     1:"#e0f2ff",2:"#cce7ff",3:"#b3daff",4:"#99ccff",5:"#80bfff",
     6:"#66b2ff",7:"#4da6ff",8:"#3399ff",9:"#1a8cff",10:"#0073e6"
   };
   return {
     color: colors[gc] || "#004c99",
     fillColor: colors[gc] || "#004c99",
     fillOpacity: 0.55,
     weight: 1
   };
 }
 
 function styleBasic(feature) {
   return {
     color: hazardColor(feature.properties.gridcode),
     weight: 1,
     fillOpacity: 0.45
   };
 }
 
 function popupGeneric(feature, layer) {
   let p = feature.properties;
   let html = "<b>Attributes:</b><br>";
   for (let k in p) html += "<b>" + k + ":</b> " + p[k] + "<br>";
   layer.bindPopup(html);
 }
 
 // =========================
 // LAYERS CONTROL
 // =========================
 var layersControl = L.control.layers(null, {}, { collapsed: false }).addTo(map);
 
 // =========================
 // LOAD LAYERS
 // =========================
-function loadLayer(file, styleFunc, label, assignTo, isRain) {
-  fetch(file).then(r => r.json()).then(data => {
-    window[assignTo] = L.geoJSON(data, {
-      style: isRain ? styleRain10 : styleFunc,
-      onEachFeature: popupGeneric
-    }).addTo(map);
-
-    layersControl.addOverlay(window[assignTo], label);
-
-    if (assignTo === "floodLayer") {
-      let safe = [];
-      data.features.forEach(f => {
-        let gc = Number(f.properties.gridcode);
-        if (gc === 1 || gc === 2) {
-          safe.push(turf.centroid(f));
-        }
-      });
-      floodSafePoints = turf.featureCollection(safe);
-    }
-  });
-}
+function loadLayer(file, styleFunc, label, assignTo, isRain) {
+  fetch(file)
+    .then(r => {
+      if (!r.ok) throw new Error(`Failed to load ${file}`);
+      return r.json();
+    })
+    .then(data => {
+      window[assignTo] = L.geoJSON(data, {
+        style: isRain ? styleRain10 : styleFunc,
+        onEachFeature: popupGeneric
+      }).addTo(map);
+
+      layersControl.addOverlay(window[assignTo], label);
+
+      if (assignTo === "floodLayer") {
+        let safe = [];
+        data.features.forEach(f => {
+          let gc = Number(f.properties.gridcode);
+          if (gc === 1 || gc === 2) {
+            safe.push(turf.centroid(f));
+          }
+        });
+        floodSafePoints = turf.featureCollection(safe);
+      }
+    })
+    .catch(err => {
+      console.error(err);
+      alert(`Error loading layer: ${label}`);
+    });
+}
 
 // change filenames حسب ملفاتك الفعلية
 loadLayer("flood.json", styleBasic, "Flood", "floodLayer", false);
 loadLayer("Ramallh_zones.json", styleBasic, "Zones", "zonesLayer", false);
 loadLayer("elev.json", styleBasic, "Elevation", "elevLayer", false);
 loadLayer("slop.json", styleBasic, "Slope", "slopeLayer", false);
 loadLayer("flow_acu.json", styleBasic, "Flow Accumulation", "flowLayer", false);
 loadLayer("soil_new.json", styleBasic, "Soil", "soilLayer", false);
 loadLayer("rain.json", styleRain10, "Rainfall (10 levels)", "rainLayer", true);
 
 // =========================
 // MAIN MAP CLICK HANDLER
 // =========================
 map.on("click", function(e) {
 
   // buffer click mode
   if (waitingForBufferClick) {
     waitingForBufferClick = false;
     handleBufferClick(e);
     return;
   }
 
   // normal analysis click
   let lat = e.latlng.lat.toFixed(6);
   let lng = e.latlng.lng.toFixed(6);
@@ -519,89 +533,85 @@ Report generated successfully.
 =================================
 `;
 
   console.log(rep);
   alert("Emergency report created. افتحي الـ Console لعرض التفاصيل.");
 };
 
 // =========================
 // DARK MODE
 // =========================
 document.getElementById("btnDark").onclick = function () {
   if (darkMode) {
     map.removeLayer(darkTiles);
     if (!map.hasLayer(lightTiles)) map.addLayer(lightTiles);
     darkMode = false;
   } else {
     map.removeLayer(lightTiles);
     if (!map.hasLayer(darkTiles)) map.addLayer(darkTiles);
     darkMode = true;
   }
 };
 
 // =========================
 // LIVE WEATHER LAYER
 // =========================
-function loadWeather() {
-  let api = "384571a4172844344b2e6e07ca33c936";
-
-  let url = `https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${api}`;
+function loadWeather() {
+  let url = `https://tile.openweathermap.org/map/precipitation_new/{z}/{x}/{y}.png?appid=${OPENWEATHER_KEY}`;
 
   if (weatherLayer && map.hasLayer(weatherLayer)) {
     map.removeLayer(weatherLayer);
   }
 
   weatherLayer = L.tileLayer(url, { opacity: 1 });
   weatherLayer.addTo(map);
 }
 
 // تحميل أول مرة وبعدها تحديث كل 5 دقائق
 loadWeather();
 setInterval(loadWeather, 300000);
 
 // =========================
 // MEASURE TOOL
 // =========================
 var measureControl = new L.Control.Measure({
   primaryLengthUnit: "meters",
   secondaryLengthUnit: "kilometers",
   primaryAreaUnit: "sqmeters",
   secondaryAreaUnit: "hectares"
 });
 measureControl.addTo(map);
 
 // =========================
 // SAFE ROUTE FINDER
 // =========================
 function drawSafeRoute(start, end) {
   if (!start || !end) return;
 
   if (routeLayer) map.removeLayer(routeLayer);
 
-  let apiKey = "eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6ImU0MGJmYjNiZDY2ODRhNTdiYTg1MTZkZmVlN2Q1Yzg2IiwiaCI6Im11cm11cjY0In0=";
-
-  let url = `https://api.openrouteservice.org/v2/directions/driving-car?api_key=${apiKey}`;
+  let url = `https://api.openrouteservice.org/v2/directions/driving-car?api_key=${OPENROUTESERVICE_KEY}`;
 
   fetch(url, {
     method: "POST",
     headers: { "Content-Type": "application/json" },
     body: JSON.stringify({
       coordinates: [
         [start.lng, start.lat],
         [end.lng, end.lat]
       ]
     })
   })
   .then(res => res.json())
   .then(json => {
     if (!json.features || !json.features.length) {
       alert("Failed to get route.");
       return;
     }
     let coords = json.features[0].geometry.coordinates.map(c => [c[1], c[0]]);
     routeLayer = L.polyline(coords, {
       color: "blue",
       weight: 5
     }).addTo(map);
     map.fitBounds(routeLayer.getBounds());
   })
   .catch(() => {









