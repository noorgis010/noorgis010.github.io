<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <title>Ramallah Flood Risk Checker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    html, body {
      height: 100%;
      margin: 0;
      direction: rtl;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f4f6f9;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    /* ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
    .info-panel {
      position: absolute;
      top: 15px;
      right: 15px;
      z-index: 1000;
      background: #ffffffee;
      padding: 12px 15px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      max-width: 320px;
      font-size: 13px;
      line-height: 1.6;
    }

    .info-panel h3 {
      margin: 0 0 8px 0;
      font-size: 15px;
    }

    .info-panel p {
      margin: 4px 0;
    }

    .info-panel small {
      font-size: 10px;
      color: #777;
    }

    .badge {
      display: inline-block;
      padding: 2px 6px;
      border-radius: 999px;
      font-size: 11px;
      color: #fff;
      margin-top: 4px;
    }
    .badge-low { background-color: #27ae60; }
    .badge-medium { background-color: #f39c12; }
    .badge-high { background-color: #c0392b; }

    .report-btn {
      display: inline-block;
      margin-top: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      cursor: pointer;
      background: #2980b9;
      color: #fff;
      text-decoration: none;
    }
    .report-btn:hover {
      background: #1f6390;
    }

    /* Legend */
    .legend {
      position: absolute;
      bottom: 25px;
      right: 15px;
      background: #ffffffdd;
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 1px 6px rgba(0,0,0,0.25);
      z-index: 1000;
      font-size: 12px;
      line-height: 1.6;
    }

    .legend-row {
      display: flex;
      align-items: center;
      margin-top: 3px;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      margin-left: 6px;
    }

    /* Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø´Ù…Ø§Ù„ */
    .north-arrow {
      position: absolute;
      top: 15px;
      left: 15px;
      z-index: 1000;
    }
    .north-arrow img {
      width: 55px;
      opacity: 0.9;
    }
  </style>
</head>
<body>

<div id="map"></div>

<!-- ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª -->
<div class="info-panel" id="info-panel">
  Ø§Ù†Ù‚Ø±ÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ Ù…Ø¯ÙŠÙ†Ø© Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ Ù„ÙØ­Øµ Ø§Ø­ØªÙ…Ø§Ù„ Ø­Ø¯ÙˆØ« ÙÙŠØ¶Ø§Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø´ØªØ§Ø¡ ğŸŒ§ï¸
</div>

<!-- Ø¥Ø´Ø§Ø±Ø© Ø§Ù„Ø´Ù…Ø§Ù„ -->
<div class="north-arrow">
  <img src="https://upload.wikimedia.org/wikipedia/commons/e/ec/Compass_rose_simple.svg" alt="North">
</div>

<!-- Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
<div class="legend">
  <strong>Ù…ÙØªØ§Ø­ Ø§Ù„Ø®Ø±ÙŠØ·Ø©</strong>
  <div class="legend-row">
    <div class="legend-color" style="background:#2ecc71;"></div>
    Ø®Ø·Ø± Ù…Ù†Ø®ÙØ¶
  </div>
  <div class="legend-row">
    <div class="legend-color" style="background:#f1c40f;"></div>
    Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·
  </div>
  <div class="legend-row">
    <div class="legend-color" style="background:#e74c3c;"></div>
    Ø®Ø·Ø± Ø¹Ø§Ù„ÙŠ
  </div>
  <div class="legend-row">
    <div class="legend-color" style="background:#3498db;"></div>
    Ø­Ø¯ÙˆØ¯ Ø£Ø­ÙŠØ§Ø¡ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡
  </div>
  <div class="legend-row">
    <div class="legend-color" style="background:#8e44ad;"></div>
    Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙŠ ØªÙ… ÙØ­ØµÙ‡
  </div>
</div>

<!-- Leaflet + Turf -->
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
  integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
  crossorigin=""
></script>
<script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>

<script>
  // 1) Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  const map = L.map('map').setView([31.903, 35.204], 13); // ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§ ÙˆØ³Ø· Ø±Ø§Ù… Ø§Ù„Ù„Ù‡

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19,
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  // Ù…Ù‚ÙŠØ§Ø³ Ø§Ù„Ø±Ø³Ù…
  L.control.scale({ position: 'bottomleft' }).addTo(map);

  const infoPanel = document.getElementById('info-panel');

  function setInfo(html) {
    infoPanel.innerHTML = html;
  }

  // 2) Ø·Ø¨Ù‚Ø© Ø£Ø­ÙŠØ§Ø¡/Ù…Ù†Ø§Ø·Ù‚ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ Ù…Ø¹ Ù…Ø³ØªÙˆÙ‰ Ø®Ø·ÙˆØ±Ø© Ø§Ù„ÙÙŠØ¶Ø§Ù†Ø§Øª
  // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°ÙŠ Ø£Ù…Ø«Ù„Ø©ØŒ Ø¹Ø¯Ù‘Ù„ÙŠ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª ÙˆØ§Ù„Ø­Ø¯ÙˆØ¯ Ø­Ø³Ø¨ Ù…Ù„ÙÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù„Ø§Ø­Ù‚Ù‹Ø§
  const ramallahZones = {
    "type": "FeatureCollection",
    "features": [
      {
        "type": "Feature",
        "properties": {
          "name": "Ø§Ù„Ù…Ø§ØµÙŠÙˆÙ†",
          "floodRisk": "medium",
          "rainMM": 600,
          "description": "Ù…Ù†Ø·Ù‚Ø© Ù…ØªÙˆØ³Ø·Ø© Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù…Ø¹ Ø¨Ø¹Ø¶ Ø§Ù„ØªØ¬Ù…Ø¹Ø§Øª Ø§Ù„Ù…Ø§Ø¦ÙŠØ© ÙÙŠ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø©.",
          "note": "ØªØ­ØªØ§Ø¬ Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªØ­ØªÙŠØ© Ù„ØªØµØ±ÙŠÙ Ù…ÙŠØ§Ù‡ Ø§Ù„Ø£Ù…Ø·Ø§Ø±."
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [[
            [35.199, 31.901],
            [35.207, 31.901],
            [35.207, 31.907],
            [35.199, 31.907],
            [35.199, 31.901]
          ]]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "name": "Ø§Ù„Ø·ÙŠØ±Ø©",
          "floodRisk": "high",
          "rainMM": 620,
          "description": "Ù…Ù†Ø·Ù‚Ø© Ù…Ù†Ø®ÙØ¶Ø© Ù†Ø³Ø¨ÙŠÙ‹Ø§ Ù…Ø¹ Ù‚Ø±Ø¨ Ù…Ù† Ù…Ø¬Ø§Ø±ÙŠ Ù…Ø§Ø¦ÙŠØ© ÙˆÙ…Ù†Ø§Ø·Ù‚ ØªØ¬Ù…Ø¹ Ù…ÙŠØ§Ù‡.",
          "note": "Ø§Ø­ØªÙ…Ø§Ù„ Ø£Ø¹Ù„Ù‰ Ù„Ø­Ø¯ÙˆØ« ÙÙŠØ¶Ø§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ© Ø®Ù„Ø§Ù„ Ø§Ù„Ø¹ÙˆØ§ØµÙ Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ø§Ù„Ù‚ÙˆÙŠØ©."
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [[
            [35.195, 31.898],
            [35.203, 31.898],
            [35.203, 31.904],
            [35.195, 31.904],
            [35.195, 31.898]
          ]]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "name": "Ø¹ÙŠÙ† Ù…ØµØ¨Ø§Ø­",
          "floodRisk": "high",
          "rainMM": 630,
          "description": "Ù‚Ø±Ø¨ Ù…Ù† Ù…Ù†Ø­Ø¯Ø±Ø§Øª ÙˆÙ‚Ù†ÙˆØ§Øª ØªØµØ±ÙŠÙØŒ Ù…Ø¹ ØªØ§Ø±ÙŠØ® Ù„Ø¨Ø¹Ø¶ ØªØ¬Ù…Ø¹Ø§Øª Ø§Ù„Ù…ÙŠØ§Ù‡.",
          "note": "ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ ØªØ­Ø³ÙŠÙ† ØªØµØ±ÙŠÙ Ù…ÙŠØ§Ù‡ Ø§Ù„Ø£Ù…Ø·Ø§Ø± ÙÙŠ Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø©."
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [[
            [35.205, 31.905],
            [35.213, 31.905],
            [35.213, 31.911],
            [35.205, 31.911],
            [35.205, 31.905]
          ]]
        }
      },
      {
        "type": "Feature",
        "properties": {
          "name": "Ø£Ù… Ø§Ù„Ø´Ø±Ø§ÙŠØ·",
          "floodRisk": "low",
          "rainMM": 580,
          "description": "Ù…Ù†Ø·Ù‚Ø© Ø£Ø¹Ù„Ù‰ Ù†Ø³Ø¨ÙŠÙ‹Ø§ ÙˆØ¨Ø¹ÙŠØ¯Ø© Ø¹Ù† Ø§Ù„Ù…Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªØ¬Ù…Ø¹ Ø§Ù„Ù…ÙŠØ§Ù‡.",
          "note": "Ø®Ø·Ø± Ø§Ù„ÙÙŠØ¶Ø§Ù†Ø§Øª Ø£Ù‚Ù„ØŒ Ù„ÙƒÙ† ØªØ¨Ù‚Ù‰ Ø§Ù„ØªØ¬Ù…Ø¹Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ù…Ù…ÙƒÙ†Ø© ÙÙŠ Ø§Ù„Ø´ÙˆØ§Ø±Ø¹ ØºÙŠØ± Ø§Ù„Ù…Ø¹Ø¨Ù‘Ø¯Ø©."
        },
        "geometry": {
          "type": "Polygon",
          "coordinates": [[
            [35.21, 31.897],
            [35.218, 31.897],
            [35.218, 31.904],
            [35.21, 31.904],
            [35.21, 31.897]
          ]]
        }
      }
    ]
  };

  function zoneColor(risk) {
    if (risk === 'high') return '#e74c3c';
    if (risk === 'medium') return '#f1c40f';
    return '#2ecc71'; // low
  }

  let highlightLayer = null;
  let clickMarker = null;

  const zonesLayer = L.geoJSON(ramallahZones, {
    style: function (feature) {
      return {
        color: '#3498db',
        weight: 1,
        fillColor: zoneColor(feature.properties.floodRisk),
        fillOpacity: 0.2
      };
    }
  }).addTo(map);

  // 3) Ø¯Ø§Ù„Ø© Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø§Ù„Ù†Ù‚Ø·Ø©
  function findZone(lat, lng) {
    const pt = turf.point([lng, lat]);
    for (let i = 0; i < ramallahZones.features.length; i++) {
      const f = ramallahZones.features[i];
      const poly = f; // GeoJSON ÙƒØ§Ù…Ù„
      if (turf.booleanPointInPolygon(pt, poly)) {
        return f;
      }
    }
    return null;
  }

  // 4) Ø²Ø± Ø§Ù„ØªØ¨Ù„ÙŠØº - Ù†Ø¨Ù†ÙŠ Ø±Ø§Ø¨Ø· Ø¥ÙŠÙ…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
  function buildReportMailLink(zone, lat, lng, riskLevelArabic) {
    // Ø¹Ø¯Ù‘Ù„ÙŠ Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù‡Ù†Ø§ Ù„Ùˆ Ø¨Ø¯Ùƒ Ø¬Ù‡Ø© Ù…Ø¹ÙŠÙ‘Ù†Ø©:
    const email = "municipality@example.com";

    const subject = "ØªØ¨Ù„ÙŠØº Ø¹Ù† Ø§Ø­ØªÙ…Ø§Ù„ ÙÙŠØ¶Ø§Ù† ÙÙŠ " + zone.properties.name;
    const bodyLines = [
      "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ",
      "",
      "Ø£ÙˆØ¯ Ø§Ù„ØªØ¨Ù„ÙŠØº Ø¹Ù† Ø§Ø­ØªÙ…Ø§Ù„ ÙÙŠØ¶Ø§Ù†/ØªØ¬Ù…Ø¹ Ù…ÙŠØ§Ù‡ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ØªØ§Ù„ÙŠ:",
      "",
      "Ø§Ù„Ù…Ù†Ø·Ù‚Ø©: " + zone.properties.name,
      "Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©: " + riskLevelArabic,
      "Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£Ù…Ø·Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ: " + zone.properties.rainMM + " Ù…Ù„Ù…",
      "",
      "Ø§Ù„ÙˆØµÙ Ø§Ù„Ù…Ø®ØªØµØ± Ù„Ù„Ù…Ù†Ø·Ù‚Ø©:",
      zone.properties.description,
      "",
      "Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø°ÙŠ ØªÙ… ÙØ­ØµÙ‡:",
      lat.toFixed(5) + ", " + lng.toFixed(5),
      "",
      "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„ØªØ¨Ù„ÙŠØº Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ·Ø¨ÙŠÙ‚ Ø®Ø±ÙŠØ·Ø© ÙØ­Øµ Ù…Ø®Ø§Ø·Ø± Ø§Ù„ÙÙŠØ¶Ø§Ù†Ø§Øª ÙÙŠ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡.",
      "",
      "Ù…Ø¹ Ø§Ù„Ø´ÙƒØ± ÙˆØ§Ù„ØªÙ‚Ø¯ÙŠØ±."
    ];

    const body = bodyLines.join("\n");
    const link =
      "mailto:" +
      encodeURIComponent(email) +
      "?subject=" +
      encodeURIComponent(subject) +
      "&body=" +
      encodeURIComponent(body);

    return link;
  }

  function riskArabicLabel(risk) {
    if (risk === 'high') return 'Ø®Ø·Ø± Ø¹Ø§Ù„Ù';
    if (risk === 'medium') return 'Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·';
    return 'Ø®Ø·Ø± Ù…Ù†Ø®ÙØ¶';
  }

  function riskBadgeClass(risk) {
    if (risk === 'high') return 'badge-high';
    if (risk === 'medium') return 'badge-medium';
    return 'badge-low';
  }

  function riskAdvice(risk) {
    if (risk === 'high') {
      return 'ÙŠÙˆØµÙ‰ Ø¨ØªØ¬Ù†Ø¨ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¨Ø§Ù†Ù Ø­Ø³Ø§Ø³Ø© Ø£Ùˆ Ø±ÙƒÙ† Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© Ø®Ù„Ø§Ù„ ÙØªØ±Ø§Øª Ø§Ù„Ø£Ù…Ø·Ø§Ø± Ø§Ù„ØºØ²ÙŠØ±Ø©ØŒ ÙˆÙ…ØªØ§Ø¨Ø¹Ø© ØªØµØ±ÙŠÙ Ù…ÙŠØ§Ù‡ Ø§Ù„Ø´ÙˆØ§Ø±Ø¹ Ø¨Ø´ÙƒÙ„ Ù…Ù†ØªØ¸Ù….';
    } else if (risk === 'medium') {
      return 'ÙŠÙˆØµÙ‰ Ø¨ØªØ­Ø³ÙŠÙ† ØªØµØ±ÙŠÙ Ù…ÙŠØ§Ù‡ Ø§Ù„Ø£Ù…Ø·Ø§Ø± ÙˆÙ…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø´ÙˆØ§Ø±Ø¹ Ø®Ù„Ø§Ù„ Ø§Ù„Ø¹ÙˆØ§ØµÙ Ø§Ù„Ù…Ø·Ø±ÙŠØ©ØŒ Ù…Ø¹ Ø§Ù„Ø§Ù†ØªØ¨Ø§Ù‡ Ù„Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ù†Ø®ÙØ¶Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªÙ‚Ø§Ø·Ø¹Ø§Øª.';
    } else {
      return 'Ø®Ø·Ø± Ø§Ù„ÙÙŠØ¶Ø§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ù…Ù†Ø®ÙØ¶ Ù†Ø³Ø¨ÙŠÙ‹Ø§ØŒ Ù„ÙƒÙ† ØªØ¨Ù‚Ù‰ Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ù…Ù‡Ù…Ø© Ù…Ø«Ù„ ØªÙ†Ø¸ÙŠÙ Ù…ØµØ§Ø±Ù Ø§Ù„Ù…ÙŠØ§Ù‡ ÙˆØ¹Ø¯Ù… Ø¥ØºÙ„Ø§Ù‚ Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØªØµØ±ÙŠÙ.';
    }
  }

  // 5) Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
  map.on('click', function (e) {
    const lat = e.latlng.lat;
    const lng = e.latlng.lng;

    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø³Ø§Ø¨Ù‚
    if (highlightLayer) {
      map.removeLayer(highlightLayer);
      highlightLayer = null;
    }
    if (clickMarker) {
      map.removeLayer(clickMarker);
      clickMarker = null;
    }

    const zone = findZone(lat, lng);

    if (!zone) {
      clickMarker = L.circleMarker([lat, lng], {
        radius: 6,
        color: '#8e44ad',
        fillColor: '#8e44ad',
        fillOpacity: 0.9
      }).addTo(map);

      setInfo(`
        <h3>Ø®Ø§Ø±Ø¬ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ù…Ø¹Ø±ÙØ©</h3>
        <p>Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ø§ ÙŠÙ‚Ø¹ Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„ØªÙŠ ØªÙ… ØªØ¹Ø±ÙŠÙÙ‡Ø§ ÙÙŠ Ø®Ø±ÙŠØ·Ø© Ø±Ø§Ù… Ø§Ù„Ù„Ù‡.</p>
        <p><strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</strong><br>${lat.toFixed(5)}, ${lng.toFixed(5)}</p>
        <small>ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ù‹Ø§ ØªÙˆØ³ÙŠØ¹ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨Ø¥Ø¶Ø§ÙØ© Ø£Ø­ÙŠØ§Ø¡/Ù…Ù†Ø§Ø·Ù‚ Ø¬Ø¯ÙŠØ¯Ø© ÙÙŠ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.</small>
      `);
      return;
    }

    // ØªØ¸Ù„ÙŠÙ„ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    highlightLayer = L.geoJSON(zone, {
      style: {
        color: '#8e44ad',
        weight: 2,
        fillColor: zoneColor(zone.properties.floodRisk),
        fillOpacity: 0.45
      }
    }).addTo(map);

    // Ù…Ø§Ø±ÙƒØ± Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„ÙØ­Øµ
    clickMarker = L.circleMarker([lat, lng], {
      radius: 6,
      color: '#8e44ad',
      fillColor: '#8e44ad',
      fillOpacity: 0.9
    }).addTo(map);

    const risk = zone.properties.floodRisk;
    const riskLabel = riskArabicLabel(risk);
    const badgeClass = riskBadgeClass(risk);
    const adviceText = riskAdvice(risk);

    // Ù†Ø­Ø¯Ø¯ Ù‡Ù„ Ù†Ø¸Ù‡Ø± Ø²Ø± Ø§Ù„ØªØ¨Ù„ÙŠØº Ø£Ù… Ù„Ø§
    let reportButtonHtml = '';
    if (risk === 'high' || risk === 'medium') {
      const mailLink = buildReportMailLink(zone, lat, lng, riskLabel);
      reportButtonHtml = `
        <a href="${mailLink}" class="report-btn">
          Ø¥Ø±Ø³Ø§Ù„ ØªØ¨Ù„ÙŠØº Ù„Ù„Ø¬Ù‡Ø§Øª Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø©
        </a>
      `;
    }

    setInfo(`
      <h3>ÙØ­Øµ Ø§Ø­ØªÙ…Ø§Ù„ Ø§Ù„ÙÙŠØ¶Ø§Ù†</h3>
      <p><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${zone.properties.name}</p>
      <p><strong>Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø®Ø·ÙˆØ±Ø©:</strong>
        <span class="badge ${badgeClass}">
          ${riskLabel}
        </span>
      </p>
      <p><strong>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø£Ù…Ø·Ø§Ø± Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ:</strong> ${zone.properties.rainMM} Ù…Ù„Ù…/Ø´ØªØ§Ø¡ (Ù‚ÙŠÙ…Ø© ØªÙ‚Ø¯ÙŠØ±ÙŠØ©)</p>
      <p><strong>ÙˆØµÙ Ù…Ø®ØªØµØ±:</strong><br>${zone.properties.description}</p>
      <p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong><br>${zone.properties.note}</p>
      <p><strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</strong><br>${lat.toFixed(5)}, ${lng.toFixed(5)}</p>
      <p><strong>Ù†ØµÙŠØ­Ø©:</strong><br>${adviceText}</p>
      ${reportButtonHtml}
      <br><small>âš ï¸ Ù‡Ø°Ù‡ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ ØªÙ‚Ø¯ÙŠØ±ÙŠØ© Ù„Ø£ØºØ±Ø§Ø¶ ØªÙˆØ¹ÙˆÙŠØ© ÙˆØªØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¨Ø³Ù‘Ø·Ø©ØŒ ÙˆÙ„ÙŠØ³Øª Ø¨Ø¯ÙŠÙ„Ù‹Ø§ Ø¹Ù† Ø¯Ø±Ø§Ø³Ø§Øª Ù‡Ù†Ø¯Ø³ÙŠØ© Ø±Ø³Ù…ÙŠØ©.</small>
    `);
  });

  // Ø±Ø³Ø§Ù„Ø© Ø£ÙˆÙ„ÙŠØ©
  setInfo('Ø§Ù†Ù‚Ø±ÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ Ù…ÙƒØ§Ù† Ø¯Ø§Ø®Ù„ Ø­Ø¯ÙˆØ¯ Ø£Ø­ÙŠØ§Ø¡ Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ Ù„ÙØ­Øµ Ø§Ø­ØªÙ…Ø§Ù„ Ø­Ø¯ÙˆØ« ÙÙŠØ¶Ø§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ© Ø®Ù„Ø§Ù„ Ø§Ù„Ø´ØªØ§Ø¡ ğŸŒ§ï¸');
</script>

</body>
</html>
