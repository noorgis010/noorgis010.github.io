<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>نظام أخطار الفيضانات - محافظة رام الله والبيره</title>

  <!-- Leaflet -->
  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      font-family: "Segoe UI", Tahoma, Arial, sans-serif;
      background: #eee;
    }

    #sidebar {
      position: absolute;
      top: 0;
      right: 0;
      width: 280px;
      height: 100%;
      background: #fff;
      padding: 10px;
      box-shadow: -2px 0 5px rgba(0,0,0,0.2);
      z-index: 1000;
      overflow-y: auto;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 280px;
    }

    .legend-box {
      background: #fff;
      padding: 8px;
      border-radius: 6px;
      font-size: 12px;
      box-shadow: 0 0 6px rgba(0,0,0,0.3);
      line-height: 18px;
    }

    .legend-box i {
      width: 14px;
      height: 14px;
      float: left;
      margin-right: 5px;
      opacity: 0.8;
    }
  </style>
</head>

<body>

<div id="sidebar">
  <h3>نظام أخطار الفيضانات</h3>
  <p>هذه النسخة الأساسية المضمونة قبل إضافة التحليل.</p>

  <h4>تقرير موقع المستخدم:</h4>
  <div id="report">
    جارٍ انتظار تحديد موقعك...
  </div>
</div>

<div id="map"></div>

<script>
// ----------------------------
// 1) إعداد الخريطة
// ----------------------------
var map = L.map('map').setView([31.9, 35.2], 12);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 19
}).addTo(map);

// ----------------------------
// 2) تحديد موقع المستخدم
// ----------------------------
map.locate({ setView: true, maxZoom: 14 });

map.on("locationfound", function(e) {
  L.marker(e.latlng).addTo(map)
    .bindPopup("موقعك الحالي").openPopup();

  document.getElementById("report").innerHTML =
    "تم تحديد موقعك بنجاح.";
});

map.on("locationerror", function() {
  document.getElementById("report").innerHTML =
    "تعذّر الوصول لموقعك.";
});

// ----------------------------
// 3) تحميل طبقة الفيضانات
// ----------------------------
var floodLayer = null;

fetch("flood.json")
  .then(res => res.json())
  .then(data => {
    floodLayer = L.geoJSON(data, {
      style: { color: "red", weight: 2, fillOpacity: 0.35 }
    }).addTo(map);
  })
  .catch(err => console.log("flood error", err));

// ----------------------------
// 4) تحميل باقي الطبقات
// ----------------------------
function loadLayer(file, label, color) {
  fetch(file)
    .then(res => res.json())
    .then(data => {
      L.geoJSON(data, {
        style: { color: color, weight: 2, fillOpacity: 0.25 }
      }).addTo(map);
    })
    .catch(err => console.log(label + " error", err));
}

loadLayer("Ramallh_zones.json", "Zones", "blue");
loadLayer("elev.json", "Elevation", "brown");
loadLayer("rain.json", "Rainfall", "cyan");
loadLayer("slop.json", "Slope", "orange");
loadLayer("soil_new.json", "Soil", "purple");
loadLayer("flow_acu.json", "Flow ACU", "green");

// ----------------------------
// 5) أسهل ليجند ممكن
// ----------------------------
var legend = L.control({position: 'bottomleft'});

legend.onAdd = function(map) {
  var div = L.DomUtil.create('div', 'legend-box');
  div.innerHTML += '<i style="background:red"></i> فيضانات<br>';
  div.innerHTML += '<i style="background:blue"></i> Zones<br>';
  div.innerHTML += '<i style="background:brown"></i> Elevation<br>';
  div.innerHTML += '<i style="background:cyan"></i> Rainfall<br>';
  div.innerHTML += '<i style="background:orange"></i> Slope<br>';
  div.innerHTML += '<i style="background:purple"></i> Soil<br>';
  div.innerHTML += '<i style="background:green"></i> Flow Acc.<br>';
  return div;
};
legend.addTo(map);

// ----------------------------
// 6) إشارة الشمال
// ----------------------------
var north = L.control({position: "topright"});
north.onAdd = function(map) {
  var div = L.DomUtil.create("div", "");
  div.innerHTML = '<img src="https://cdn-icons-png.flaticon.com/512/54/54248.png" width="50"/>';
  return div;
};
north.addTo(map);

</script>

</body>
</html>






